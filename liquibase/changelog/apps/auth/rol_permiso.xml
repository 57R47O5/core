<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.23.xsd">

    <changeSet
        id="auth-005-create-rol-permiso"
        author="orco">

        <createTable tableName="rol_permiso">

            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>

            <column name="rol_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>

            <column name="permiso_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>

            <!-- Estado -->
            <column name="is_deleted" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>

            <!-- Auditoría -->
            <column name="createdat" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="updatedat" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="createdby_id" type="BIGINT"/>
            <column name="updatedby_id" type="BIGINT"/>

        </createTable>

        <!-- Restricción única -->
        <addUniqueConstraint
            tableName="rol_permiso"
            columnNames="rol_id,permiso_id"
            constraintName="uq_rol_permiso"/>

        <!-- FKs -->
        <addForeignKeyConstraint
            baseTableName="rol_permiso"
            baseColumnNames="rol_id"
            referencedTableName="rol"
            referencedColumnNames="id"
            constraintName="fk_rol_permiso_rol"/>

        <addForeignKeyConstraint
            baseTableName="rol_permiso"
            baseColumnNames="permiso_id"
            referencedTableName="permiso"
            referencedColumnNames="id"
            constraintName="fk_rol_permiso_permiso"/>

        <!-- Índices -->
        <createIndex tableName="rol_permiso" indexName="idx_rol_permiso_rol">
            <column name="rol_id"/>
        </createIndex>

        <createIndex tableName="rol_permiso" indexName="idx_rol_permiso_permiso">
            <column name="permiso_id"/>
        </createIndex>

    </changeSet>

</databaseChangeLog>
